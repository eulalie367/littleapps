(function(){tinymce.PluginManager.requireLangPack("umbraco");tinymce.create("tinymce.plugins.umbracomacro",{init:function(A,B){var C=this;A.addCommand("mceumbracomacro",function(){var H=A.selection;var D="";var G=H.getNode();if(!A.dom.hasClass(G,"umbMacroHolder")){G=A.dom.getParent(G,"div.umbMacroHolder")}var F="";if(A.dom.hasClass(G,"umbMacroHolder")){for(var E=0;E<G.attributes.length;E++){attrName=G.attributes[E].nodeName.toLowerCase();if(attrName!="mce_serialized"){if(G.attributes[E].nodeValue&&(attrName!="ismacro"&&attrName!="style"&&attrName!="contenteditable")){F+=G.attributes[E].nodeName+"="+escape(C._utf8_encode(G.attributes[E].nodeValue))+"&"}}}if(F.length>0){F=F.substr(0,F.length-1)}D="&"+F}else{D="&umbPageId="+tinyMCE.activeEditor.getParam("theme_umbraco_pageId")+"&umbVersionId="+tinyMCE.activeEditor.getParam("theme_umbraco_versionId")}A.windowManager.open({file:tinyMCE.activeEditor.getParam("umbraco_path")+"/plugins/tinymce3/insertMacro.aspx?editor=trueurl"+D,width:480+parseInt(A.getLang("umbracomacro.delta_width",0)),height:470+parseInt(A.getLang("umbracomacro.delta_height",0)),inline:1},{plugin_url:B})});A.addButton("umbracomacro",{title:"umbracomacro.desc",cmd:"mceumbracomacro",image:B+"/img/insMacro.gif"});A.onNodeChange.addToTop(function(E,D,H){var G=E.dom.getParent(E.selection.getStart(),"div.umbMacroHolder");if(G){E.selection.select(G);var F=E.selection.getStart();if(tinymce.isIE){if(!E.dom.hasClass(F,"umbMacroHolder")){while(!E.dom.hasClass(F,"umbMacroHolder")&&F.parentNode){F=F.parentNode}E.selection.select(F)}}D.setActive("umbracomacro",E.dom.hasClass(F,"umbMacroHolder")||E.dom.hasClass(G,"umbMacroHolder"))}})},_utf8_encode:function(B){B=B.replace(/\r\n/g,"\n");var A="";for(var D=0;D<B.length;D++){var C=B.charCodeAt(D);if(C<128){A+=String.fromCharCode(C)}else{if((C>127)&&(C<2048)){A+=String.fromCharCode((C>>6)|192);A+=String.fromCharCode((C&63)|128)}else{A+=String.fromCharCode((C>>12)|224);A+=String.fromCharCode(((C>>6)&63)|128);A+=String.fromCharCode((C&63)|128)}}}return A},createControl:function(B,A){return null},getInfo:function(){return{longname:"Umbraco Macro Insertion Plugin",author:"Umbraco",authorurl:"http://umbraco.org",infourl:"http://umbraco.org/redir/tinymcePlugins",version:"1.0"}}});tinymce.PluginManager.add("umbracomacro",tinymce.plugins.umbracomacro)})();